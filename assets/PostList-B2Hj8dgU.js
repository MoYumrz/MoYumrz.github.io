import{d as A,e as G,f as J,w as K,r as w,K as D,L as X,c as u,a as r,i as e,j as s,M as Z,N as M,O as b,G as g,m as I,b as q,u as ee,s as te,o as c,k as l,t as _,l as p,C as se,P as ae,Q as ne,R as oe,S as le,E as v,T as re,U as ce,x as ie,V as ue,W as de,X as _e,Y as fe,Z as me,$ as ge,a0 as pe,_ as ve}from"./index-DM1-aU-Q.js";import"./el-infinite-scroll-l0sNRNKZ.js";/* empty css                 */const ye={class:"post-list"},he={class:"title"},ke=["infinite-scroll-disabled"],we={class:"item"},Ie={class:"top"},xe={key:0,style:{"margin-left":"auto",display:"flex","align-items":"center"}},Ce={class:"el-dropdown-link"},Ee=["onClick"],Te={class:"tag-title"},Se={class:"content"},Le={key:0,class:"covers"},Ne={class:"bottom"},ze={style:{"margin-right":"5px"}},De={class:"comment-like"},Me={class:"comment"},be={class:"like"},Be={key:0,class:"loading",style:{display:"flex","justify-content":"center",height:"50px"}},Pe={key:1,class:"no-more-data",style:{display:"flex","justify-content":"center",height:"50px"}},$e=A({__name:"PostList",setup(Re){const x=G(),y=q(),C=ee();J(()=>{E()}),K(()=>y.params.userId,()=>{d.value=[],E()});const h=w(!1),S=D(()=>f.value.current*f.value.pageSize>=L.value),B=D(()=>h.value||S.value),P=()=>{h.value=!0,f.value.current++,E(),h.value=!1},d=w([]),L=w(0),f=w({status:null,current:1,pageSize:10}),E=async()=>{x.userInfo.userId!=y.params.userId?f.value.status=2:f.value.status=null;try{const a=await X(Number(y.params.userId),f.value);d.value=d.value.concat(a.data.data.records),L.value=a.data.data.total}catch(a){console.error(a)}},$=a=>{C.push({path:"/newPost",state:{postId:a}})},R=a=>{le.confirm("确定删除该文章吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V(a)}).catch(()=>{v.info("已取消删除")})},V=async a=>{try{const t=await re(a);t.data.code===200?(v.success("删除成功"),d.value=d.value.filter(o=>o.postId!==a)):v.error(t.data.msg)}catch(t){console.error(t)}},N=async(a,t)=>{try{const o=await ce(a,t);o.data.code===200?(v.success("修改状态成功"),C.go(0)):v.error(o.data.msg)}catch(o){console.error(o)}},j=a=>a.replace(/<img[^>]*>/g,"[图片]").replace(/<[^>]*>/g,""),F=a=>{const t=new Date(a),o=new Date,i=o.getTime()-t.getTime();return i<6e4?"刚刚":i<36e5?Math.floor(i/6e4)+"分钟前":i<864e5?Math.floor(i/36e5)+"小时前":i<1728e5?"昨天 ":o.getFullYear()===t.getFullYear()?t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}).replace(/\//g,"-").replace("，",""):t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-")},H=a=>{switch(a){case-2:return"下架";case-1:return"不通过";case 0:return"草稿";case 1:return"审核中";case 2:return"已发布";default:return"未知"}},W=a=>{switch(a){case-2:return"warning";case-1:return"danger";case 0:return"info";case 1:return"primary";case 2:return"success";default:return"primary"}};return(a,t)=>{const o=te,i=ie,T=ue,k=de,Y=_e,O=fe,z=me,Q=ge,U=pe;return c(),u("div",ye,[r("div",he,[e(o,{size:"large",tag:"b"},{default:s(()=>[l(_(p(x).userInfo.userId==p(y).params.userId?"我的发帖":"发帖"),1)]),_:1})]),d.value.length>0?Z((c(),u("div",{key:0,"infinite-scroll-disabled":B.value},[(c(!0),u(M,null,b(d.value,n=>(c(),u("div",we,[r("div",Ie,[e(o,{type:"info"},{default:s(()=>[e(i,{size:"large"},{default:s(()=>[e(p(se))]),_:1})]),_:1}),e(o,{class:"time"},{default:s(()=>[l(_(F(n.updatedTime)),1)]),_:2},1024),p(x).userInfo.userId==n.userId?(c(),u("div",xe,[e(T,{class:"status",type:W(n.status)},{default:s(()=>[l(_(H(n.status)),1)]),_:2},1032,["type"]),e(O,{trigger:"click",class:"more",style:{"margin-left":"20px"}},{dropdown:s(()=>[e(Y,null,{default:s(()=>[e(k,{onClick:m=>$(n.postId)},{default:s(()=>t[0]||(t[0]=[l("编辑")])),_:2},1032,["onClick"]),n.status==-2?(c(),I(k,{key:0,onClick:m=>N(n.postId,1)},{default:s(()=>t[1]||(t[1]=[l("上架")])),_:2},1032,["onClick"])):g("",!0),n.status==1||n.status==2?(c(),I(k,{key:1,onClick:m=>N(n.postId,-2)},{default:s(()=>t[2]||(t[2]=[l("下架")])),_:2},1032,["onClick"])):g("",!0),e(k,{onClick:m=>R(n.postId)},{default:s(()=>t[3]||(t[3]=[l("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[r("span",Ce,[e(i,{class:"el-icon--right"},{default:s(()=>[e(p(ae))]),_:1})])]),_:2},1024)])):g("",!0)]),r("div",{class:"center",onClick:m=>p(C).push(`/post/${n.postId}`)},[r("div",Te,[e(T,{class:"tag",color:n.themeColor,effect:"dark",size:"small",hit:""},{default:s(()=>[l(_(n.sectionName),1)]),_:2},1032,["color"]),e(o,{tag:"b",truncated:"",size:"large",class:"post-title"},{default:s(()=>[l(_(n.title),1)]),_:2},1024)]),r("div",Se,[e(o,{innerHTML:j(n.content),truncated:!0},null,8,["innerHTML"])]),n.cover!=null?(c(),u("div",Le,[(c(!0),u(M,null,b(JSON.parse(n.cover),m=>(c(),I(z,{style:{width:"120px",height:"120px"},src:m,fit:"cover"},null,8,["src"]))),256))])):g("",!0)],8,Ee),r("div",Ne,[r("div",null,[e(T,{type:"info",class:"tag"},{default:s(()=>[r("div",ze,[e(z,{style:{width:"20px",height:"20px"},src:n.categoryIcon,fit:"fill"},null,8,["src"])]),r("div",null,[e(o,{class:"tag-name",size:"small"},{default:s(()=>[l(_(n.categoryName),1)]),_:2},1024)])]),_:2},1024)]),r("div",De,[r("div",Me,[e(i,null,{default:s(()=>[e(ne)]),_:1}),e(o,{class:"comment-count",type:"info"},{default:s(()=>[l(_(n.commentCount),1)]),_:2},1024)]),r("div",be,[e(i,null,{default:s(()=>[e(oe)]),_:1}),e(o,{class:"like-count",type:"info"},{default:s(()=>[l(_(n.likesCount),1)]),_:2},1024)])])])]))),256)),h.value?(c(),u("div",Be,[e(o,{type:"info"},{default:s(()=>t[4]||(t[4]=[l("正在加载中")])),_:1})])):g("",!0),S.value&&d.value.length>0?(c(),u("div",Pe,[e(o,{type:"info"},{default:s(()=>t[5]||(t[5]=[l("已经到底了")])),_:1})])):g("",!0)],8,ke)),[[U,P]]):(c(),I(Q,{key:1,description:"暂时没有帖子"}))])}}}),He=ve($e,[["__scopeId","data-v-31a7908f"]]);export{He as default};
