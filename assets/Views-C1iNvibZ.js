import{a4 as A,d as G,e as J,f as K,w as Q,r as k,K as B,c as r,a as o,i as e,j as t,M as U,N as L,O as V,G as v,m as $,b as X,u as Z,s as ee,o as i,k as c,l as _,C as R,t as m,P as j,S as te,E as se,x as ae,W as ne,X as oe,Y as le,q as ie,V as re,Z as ce,$ as de,a0 as ue,_ as _e}from"./index-DM1-aU-Q.js";import"./el-infinite-scroll-l0sNRNKZ.js";/* empty css                 */function me(p,f){return A({url:"/user/views/page/"+p,method:"get",params:{pageSize:f.pageSize,current:f.current}})}function fe(p){return A({url:"/user/views/"+p,method:"delete"})}const ge={class:"view-list"},ve={class:"title"},pe=["infinite-scroll-disabled"],he={key:0},ye={class:"top"},ke={key:0,style:{"margin-left":"auto",display:"flex","align-items":"center"}},we={class:"el-dropdown-link"},xe={class:"top-bottom"},Ie=["onClick"],Ce={class:"user-avatar"},Ee=["onClick"],ze={class:"tag-title"},Se={class:"content"},Te={key:0,class:"covers"},Ne={class:"bottom"},be={style:{"margin-right":"5px"}},De={key:1},Me={class:"top"},Be={key:0,style:{"margin-left":"auto",display:"flex","align-items":"center"}},Le={class:"el-dropdown-link"},Ve={class:"center"},$e={key:0,class:"loading",style:{display:"flex","justify-content":"center",height:"50px"}},Re={key:1,class:"no-more-data",style:{display:"flex","justify-content":"center",height:"50px"}},je=G({__name:"Views",setup(p){const f=J(),x=X(),I=Z();K(()=>{w()}),Q(()=>x.params.userId,()=>{u.value=[],w()});const h=k(!1),C=B(()=>y.value.current*y.value.pageSize>=E.value),F=B(()=>h.value||C.value),H=()=>{h.value=!0,y.value.current++,w(),h.value=!1},u=k([]),E=k(0),y=k({current:1,pageSize:10}),w=async()=>{try{const l=await me(Number(x.params.userId),y.value);u.value=u.value.concat(l.data.data.records),console.log(u.value),E.value=l.data.data.total}catch(l){console.error(l)}},z=l=>{te.confirm("确定删除该浏览记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W(l)}).catch(()=>{se.info("已取消删除")})},W=async l=>{try{(await fe(l)).data.code===200&&(u.value=u.value.filter(n=>n.viewsId!==l))}catch(s){console.error(s)}},Y=l=>l.replace(/<img[^>]*>/g,"[图片]").replace(/<[^>]*>/g,""),S=l=>{const s=new Date(l),n=new Date,d=n.getTime()-s.getTime();return d<6e4?"刚刚":d<36e5?Math.floor(d/6e4)+"分钟前":d<864e5?Math.floor(d/36e5)+"小时前":d<1728e5?"昨天 ":n.getFullYear()===s.getFullYear()?s.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}).replace(/\//g,"-").replace("，",""):s.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-")};return(l,s)=>{const n=ee,d=ae,T=ne,N=oe,b=le,O=ie,D=re,M=ce,P=de,q=ue;return i(),r("div",ge,[o("div",ve,[e(n,{size:"large",tag:"b"},{default:t(()=>s[0]||(s[0]=[c("浏览记录")])),_:1})]),u.value.length>0?U((i(),r("div",{key:0,"infinite-scroll-disabled":F.value},[(i(!0),r(L,null,V(u.value,a=>(i(),r("div",{key:a.postId,class:"item"},[a.title?(i(),r("div",he,[o("div",ye,[e(n,{type:"info"},{default:t(()=>[e(d,{size:"large"},{default:t(()=>[e(_(R))]),_:1})]),_:1}),e(n,{class:"time"},{default:t(()=>[c(m(S(a.createdTime)),1)]),_:2},1024),_(f).userInfo.userId==a.userId?(i(),r("div",ke,[e(b,{trigger:"click",class:"more",style:{"margin-left":"20px"}},{dropdown:t(()=>[e(N,null,{default:t(()=>[e(T,{onClick:g=>z(a.viewsId)},{default:t(()=>s[1]||(s[1]=[c("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[o("span",we,[e(d,{class:"el-icon--right"},{default:t(()=>[e(_(j))]),_:1})])]),_:2},1024)])):v("",!0)]),o("div",xe,[o("div",{class:"user",onClick:g=>_(I).push({name:"postList",params:{userId:a.authorId}})},[o("div",Ce,[e(O,{src:a.avatar},null,8,["src"])]),o("div",null,[e(n,{class:"user-name"},{default:t(()=>[c(m(a.nickname),1)]),_:2},1024)])],8,Ie)]),o("div",{class:"center",onClick:g=>_(I).push(`/post/${a.postId}`)},[o("div",ze,[e(D,{class:"tag",color:a.themeColor,effect:"dark",size:"small",hit:""},{default:t(()=>[c(m(a.sectionName),1)]),_:2},1032,["color"]),e(n,{tag:"b",truncated:"",size:"large",class:"post-title"},{default:t(()=>[c(m(a.title),1)]),_:2},1024)]),o("div",Se,[e(n,{innerHTML:Y(a.content),truncated:!0},null,8,["innerHTML"])]),a.cover!=null?(i(),r("div",Te,[(i(!0),r(L,null,V(JSON.parse(a.cover),g=>(i(),$(M,{style:{width:"120px",height:"120px"},src:g,fit:"cover"},null,8,["src"]))),256))])):v("",!0)],8,Ee),o("div",Ne,[o("div",null,[e(D,{type:"info",class:"tag"},{default:t(()=>[o("div",be,[e(M,{style:{width:"20px",height:"20px"},src:a.categoryIcon,fit:"fill"},null,8,["src"])]),o("div",null,[e(n,{class:"tag-name",size:"small"},{default:t(()=>[c(m(a.categoryName),1)]),_:2},1024)])]),_:2},1024)])])])):(i(),r("div",De,[o("div",Me,[e(n,{type:"info"},{default:t(()=>[e(d,{size:"large"},{default:t(()=>[e(_(R))]),_:1})]),_:1}),e(n,{class:"time"},{default:t(()=>[c(m(S(a.createdTime)),1)]),_:2},1024),_(f).userInfo.userId==a.userId?(i(),r("div",Be,[e(b,{trigger:"click",class:"more",style:{"margin-left":"20px"}},{dropdown:t(()=>[e(N,null,{default:t(()=>[e(T,{onClick:g=>z(a.viewsId)},{default:t(()=>s[2]||(s[2]=[c("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[o("span",Le,[e(d,{class:"el-icon--right"},{default:t(()=>[e(_(j))]),_:1})])]),_:2},1024)])):v("",!0)]),o("div",Ve,[e(n,null,{default:t(()=>s[3]||(s[3]=[c("此文章已不存在")])),_:1})])]))]))),128)),h.value?(i(),r("div",$e,[e(n,{type:"info"},{default:t(()=>s[4]||(s[4]=[c("正在加载中")])),_:1})])):v("",!0),C.value&&u.value.length>0?(i(),r("div",Re,[e(n,{type:"info"},{default:t(()=>s[5]||(s[5]=[c("已经到底了")])),_:1})])):v("",!0)],8,pe)),[[q,H]]):(i(),$(P,{key:1,description:"暂时没有浏览记录"}))])}}}),We=_e(je,[["__scopeId","data-v-38a17ddb"]]);export{We as default};
